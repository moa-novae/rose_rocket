{"ast":null,"code":"import { useState, useEffect } from \"react\";\nexport default function useGenerateCsf(yearlyTasks, driversList) {\n  const [csvInterval, setCsvInterval] = useState({\n    id: 2,\n    name: \"2 days\"\n  });\n  const [driverSelected, setDriverSelected] = useState(driversList[0]);\n  const [data, setData] = useState([]);\n  const possibleInterval = [{\n    id: 2,\n    name: \"2 days\"\n  }, {\n    id: 4,\n    name: \"4 days\"\n  }, {\n    id: 7,\n    name: \"7 days\"\n  }, {\n    id: 14,\n    name: \"14 days\"\n  }, {\n    id: 28,\n    name: \"28 days\"\n  }];\n  const headers = [{\n    label: \"Time Frame\",\n    key: \"timeFrame\"\n  }, {\n    label: \"Pickup\",\n    key: \"pickup\"\n  }, {\n    label: \"Drop-off\",\n    key: \"dropoff\"\n  }, {\n    label: \"Other\",\n    key: \"other\"\n  }];\n\n  function summarizeDriverActivities() {\n    const intervalDuration = csvInterval.id; // find all task of the driver selected\n    // convert map to array first\n\n    const driverTasks = Array.from(yearlyTasks.values()).filter(task => task.driver.id === driverSelected.id); // generate the accumulator object used to tally tasks\n\n    let initialAccumulator = {};\n\n    for (let i = 0; i < 364; i++) {\n      // if beginning of interval\n      if (i % intervalDuration === 0) {\n        initialAccumulator[i] = {\n          pickup: 0,\n          dropoff: 0,\n          other: 0\n        };\n      }\n    }\n\n    function sumEachInterval(initialAccumulator, tasks) {\n      const taskTally = tasks.reduce((accumulator, task) => {\n        const taskDay = Math.floor(task.time.start / 24);\n        /* ex: for day 5 at 2 day interval, the interval \n        which it belongs to is 4 - 5. so taskInterval = 4*/\n\n        const taskInterval = taskDay - taskDay % intervalDuration;\n        const newAccumulator = { ...accumulator\n        }; // increment the appropriate task type\n\n        newAccumulator[taskInterval][task.type] += 1;\n        return newAccumulator;\n      }, initialAccumulator);\n      return Object.entries(taskTally);\n    } // transform data to shape accepted by react-csv\n\n\n    function transformToCsvShape(data) {\n      const output = [];\n\n      for (const [intervalStartDay, tally] of data) {\n        output.push({\n          timeFrame: `Day ${intervalStartDay} - Day ${parseInt(intervalStartDay) + intervalDuration}`,\n          ...tally\n        });\n      }\n\n      return output;\n    }\n\n    return transformToCsvShape(sumEachInterval(initialAccumulator, driverTasks));\n  }\n\n  function handleDownload() {\n    setData(summarizeDriverActivities());\n  }\n\n  const fileName = `${driverSelected.name}-${driverSelected.id}-${csvInterval.name}-interval-summary`;\n  return {\n    csvInterval,\n    setCsvInterval,\n    possibleInterval,\n    driverSelected,\n    setDriverSelected,\n    handleDownload,\n    data,\n    headers,\n    fileName\n  };\n}","map":{"version":3,"sources":["/home/momo/portfolio/roseRocket/client/src/components/Calendar/CalendarSidebar/GenerateCsv/useGenerateCsv.js"],"names":["useState","useEffect","useGenerateCsf","yearlyTasks","driversList","csvInterval","setCsvInterval","id","name","driverSelected","setDriverSelected","data","setData","possibleInterval","headers","label","key","summarizeDriverActivities","intervalDuration","driverTasks","Array","from","values","filter","task","driver","initialAccumulator","i","pickup","dropoff","other","sumEachInterval","tasks","taskTally","reduce","accumulator","taskDay","Math","floor","time","start","taskInterval","newAccumulator","type","Object","entries","transformToCsvShape","output","intervalStartDay","tally","push","timeFrame","parseInt","handleDownload","fileName"],"mappings":"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","sourcesContent":["import { useState, useEffect } from \"react\";\nexport default function useGenerateCsf(yearlyTasks, driversList) {\n  const [csvInterval, setCsvInterval] = useState({ id: 2, name: \"2 days\" });\n  const [driverSelected, setDriverSelected] = useState(driversList[0]);\n  const [data, setData] = useState([]);\n\n  const possibleInterval = [\n    { id: 2, name: \"2 days\" },\n    { id: 4, name: \"4 days\" },\n    { id: 7, name: \"7 days\" },\n    { id: 14, name: \"14 days\" },\n    { id: 28, name: \"28 days\" },\n  ];\n  const headers = [\n    { label: \"Time Frame\", key: \"timeFrame\" },\n    { label: \"Pickup\", key: \"pickup\" },\n    { label: \"Drop-off\", key: \"dropoff\" },\n    { label: \"Other\", key: \"other\" },\n  ];\n  function summarizeDriverActivities() {\n    const intervalDuration = csvInterval.id;\n    // find all task of the driver selected\n    // convert map to array first\n    const driverTasks = Array.from(yearlyTasks.values()).filter(\n      (task) => task.driver.id === driverSelected.id\n    );\n    // generate the accumulator object used to tally tasks\n    let initialAccumulator = {};\n    for (let i = 0; i < 364; i++) {\n      // if beginning of interval\n      if (i % intervalDuration === 0) {\n        initialAccumulator[i] = { pickup: 0, dropoff: 0, other: 0 };\n      }\n    }\n\n    function sumEachInterval(initialAccumulator, tasks) {\n      const taskTally = tasks.reduce((accumulator, task) => {\n        const taskDay = Math.floor(task.time.start / 24);\n        /* ex: for day 5 at 2 day interval, the interval \n        which it belongs to is 4 - 5. so taskInterval = 4*/\n        const taskInterval = taskDay - (taskDay % intervalDuration);\n        const newAccumulator = { ...accumulator };\n        // increment the appropriate task type\n        newAccumulator[taskInterval][task.type] += 1;\n        return newAccumulator;\n      }, initialAccumulator);\n      return Object.entries(taskTally);\n    }\n    // transform data to shape accepted by react-csv\n    function transformToCsvShape(data) {\n      const output = [];\n      for (const [intervalStartDay, tally] of data) {\n        output.push({\n          timeFrame: `Day ${intervalStartDay} - Day ${\n            parseInt(intervalStartDay) + intervalDuration\n          }`,\n          ...tally,\n        });\n      }\n      return output;\n    }\n    return transformToCsvShape(\n      sumEachInterval(initialAccumulator, driverTasks)\n    );\n  }\n\n  function handleDownload() {\n    setData(summarizeDriverActivities());\n  }\n  const fileName = `${driverSelected.name}-${driverSelected.id}-${csvInterval.name}-interval-summary`;\n\n  return {\n    csvInterval,\n    setCsvInterval,\n    possibleInterval,\n    driverSelected,\n    setDriverSelected,\n    handleDownload,\n    data,\n    headers,\n    fileName,\n  };\n}\n"]},"metadata":{},"sourceType":"module"}